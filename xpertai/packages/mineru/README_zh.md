# MinerU XpertAI æ’ä»¶

ä¸º [XpertAI](https://github.com/xpert-ai/xpert) å¹³å°æä¾›çš„å¼ºå¤§ PDF è½¬ Markdown è½¬æ¢æ’ä»¶ï¼ŒåŸºäº [MinerU](https://mineru.net) æœåŠ¡ã€‚è¯¥æ’ä»¶æä¾›ä¸ MinerU æœåŠ¡çš„æ— ç¼é›†æˆï¼Œå¯å°† PDF æ–‡æ¡£æå–å¹¶è½¬æ¢ä¸ºç»“æ„åŒ– Markdown æ ¼å¼ï¼Œæ”¯æŒ OCRã€å…¬å¼è¯†åˆ«å’Œè¡¨æ ¼æå–ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“„ **PDF è½¬ Markdown è½¬æ¢**ï¼šå°† PDF æ–‡æ¡£è½¬æ¢ä¸ºæ¸…æ™°ã€ç»“æ„åŒ–çš„ Markdown æ ¼å¼
- ğŸ” **OCR æ”¯æŒ**ï¼šä½¿ç”¨ OCR æŠ€æœ¯ä»åŸºäºå›¾åƒçš„ PDF ä¸­æå–æ–‡æœ¬
- ğŸ“ **å…¬å¼è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä¿ç•™æ•°å­¦å…¬å¼
- ğŸ“Š **è¡¨æ ¼æå–**ï¼šä» PDF æ–‡æ¡£ä¸­æå–å¹¶ç»“æ„åŒ–è¡¨æ ¼
- ğŸ¤– **æ™ºèƒ½ä½“å·¥å…·é›†é›†æˆ**ï¼šåœ¨ XpertAI æ™ºèƒ½ä½“å·¥ä½œæµä¸­ä½œä¸ºå†…ç½®å·¥å…·é›†ä½¿ç”¨
- ğŸ”„ **æ–‡æ¡£è½¬æ¢å™¨**ï¼šåœ¨çŸ¥è¯†åº“ç®¡é“ä¸­è½¬æ¢æ–‡æ¡£
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒè‹±æ–‡å’Œä¸­æ–‡æ–‡æ¡£
- ğŸ¢ **è‡ªæ‰˜ç®¡æ”¯æŒ**ï¼šæ”¯æŒå®˜æ–¹ MinerU API å’Œè‡ªæ‰˜ç®¡éƒ¨ç½²

## å®‰è£…

```bash
pnpm add @xpert-ai/plugin-mineru
# æˆ–
npm install @xpert-ai/plugin-mineru
```

###  peer ä¾èµ–

æ­¤æ’ä»¶éœ€è¦åœ¨å®¿ä¸»é¡¹ç›®ä¸­å®‰è£…ä»¥ä¸‹ peer ä¾èµ–ï¼š

- `@xpert-ai/plugin-sdk`: ^3.6.2
- `@nestjs/common`: ^11.1.6
- `@nestjs/config`: ^4.0.2
- `@metad/contracts`: ^3.6.2
- `@langchain/core`: 0.3.72
- `axios`: 1.12.2
- `zod`: 3.25.67
- `uuid`: 8.3.2

## å¿«é€Ÿå¼€å§‹

### 1. è·å– MinerU API å‡­è¯

1. åœ¨ [mineru.net](https://mineru.net) æ³¨å†Œ MinerU è´¦æˆ·
2. ä» MinerU æ§åˆ¶å°è·å–æ‚¨çš„ API Key
3. è®°å½• API åŸºç¡€ URLï¼ˆé»˜è®¤ï¼š`https://mineru.net/api/v4`ï¼‰

### 2. é…ç½®æ’ä»¶

#### æ–¹å¼ Aï¼šé€šè¿‡ XpertAI æ§åˆ¶å°ï¼ˆæ¨èï¼‰

1. åœ¨ XpertAI æ§åˆ¶å°ä¸­å¯¼èˆªåˆ°"å†…ç½®å·¥å…·"éƒ¨åˆ†
2. åœ¨å·¥å…·é›†åˆ—è¡¨ä¸­æ‰¾åˆ°"MinerU PDF è§£æå™¨"
3. ç‚¹å‡»"æˆæƒ"å¹¶å¡«å†™é…ç½®ï¼š
   - **Base URL**ï¼šMinerU API åŸºç¡€ URLï¼ˆé»˜è®¤ï¼š`https://mineru.net/api/v4`ï¼‰
   - **API Key**ï¼šæ‚¨çš„ MinerU API Keyï¼ˆå¿…å¡«ï¼‰
   - **å¯ç”¨ OCR**ï¼šä¸ºåŸºäºå›¾åƒçš„ PDF å¯ç”¨/ç¦ç”¨ OCRï¼ˆé»˜è®¤ï¼šå¯ç”¨ï¼‰
   - **å¯ç”¨å…¬å¼è¯†åˆ«**ï¼šå¯ç”¨/ç¦ç”¨å…¬å¼è¯†åˆ«ï¼ˆé»˜è®¤ï¼šå¯ç”¨ï¼‰
   - **å¯ç”¨è¡¨æ ¼è¯†åˆ«**ï¼šå¯ç”¨/ç¦ç”¨è¡¨æ ¼è¯†åˆ«ï¼ˆé»˜è®¤ï¼šå¯ç”¨ï¼‰
   - **æ–‡æ¡£è¯­è¨€**ï¼šé€‰æ‹©æ–‡æ¡£è¯­è¨€ - "en" è¡¨ç¤ºè‹±æ–‡ï¼Œ"ch" è¡¨ç¤ºä¸­æ–‡ï¼ˆé»˜è®¤ï¼š"ch"ï¼‰
   - **æ¨¡å‹ç‰ˆæœ¬**ï¼šé€‰æ‹©æ¨¡å‹ç‰ˆæœ¬ - "pipeline" æˆ– "vlm"ï¼ˆé»˜è®¤ï¼š"pipeline"ï¼‰

#### æ–¹å¼ Bï¼šç¯å¢ƒå˜é‡

åœ¨éƒ¨ç½²ç¯å¢ƒä¸­è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
MINERU_API_BASE_URL=https://mineru.net/api/v4  # å¯é€‰ï¼Œé»˜è®¤ä¸ºå®˜æ–¹ URL
MINERU_API_TOKEN=your-api-key-here              # å¿…å¡«
MINERU_SERVER_TYPE=official                     # å¯é€‰ï¼š'official' æˆ– 'self-hosted'
```

### 3. æ³¨å†Œæ’ä»¶

å°†æ’ä»¶æ·»åŠ åˆ°æ‚¨çš„ XpertAI å®¿ä¸»æœåŠ¡é…ç½®ä¸­ï¼š

```bash
# .env
PLUGINS=@xpert-ai/plugin-mineru
```

æ’ä»¶å°†è‡ªåŠ¨æ³¨å†Œ `MinerUPlugin` NestJS æ¨¡å—ï¼Œå¯åœ¨æ™ºèƒ½ä½“å·¥ä½œæµä¸­ä½¿ç”¨ã€‚

## ä½¿ç”¨æ–¹æ³•

### ä½œä¸ºæ™ºèƒ½ä½“å·¥ä½œæµä¸­çš„å·¥å…·é›†

é…ç½®å®Œæˆåï¼ŒMinerU å·¥å…·é›†å¯åœ¨æ‚¨çš„æ™ºèƒ½ä½“å·¥ä½œæµä¸­ä½¿ç”¨ã€‚è¯¥å·¥å…·æ¥å— PDF æ–‡æ¡£ URL å¹¶è¿”å›è½¬æ¢åçš„ Markdown å†…å®¹ã€‚

**å·¥å…·è¾“å…¥ï¼š**
```json
{
  "doc_url": "https://example.com/document.pdf"
}
```

**å·¥å…·è¾“å‡ºï¼š**
- åŒ…å«æå–çš„æ–‡æœ¬ã€å…¬å¼å’Œè¡¨æ ¼çš„ Markdown å†…å®¹
- åŒ…æ‹¬ä»»åŠ¡ ID å’Œæ–‡æ¡£ä¿¡æ¯çš„ç»“æ„åŒ–å…ƒæ•°æ®
- ä» PDF ä¸­æå–çš„å›¾åƒèµ„æº

### é…ç½®é€‰é¡¹

#### å·¥å…·é›†é…ç½®ï¼ˆæˆæƒé¡µé¢ï¼‰

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `apiUrl` | string | `https://mineru.net/api/v4` | MinerU API åŸºç¡€ URL |
| `apiKey` | string | - | MinerU API Keyï¼ˆå¿…å¡«ï¼‰ |
| `isOcr` | å­—ç¬¦ä¸²æšä¸¾ | `"true"` | ä¸ºåŸºäºå›¾åƒçš„ PDF å¯ç”¨ OCRï¼ˆ`"true"` æˆ– `"false"`ï¼‰ |
| `enableFormula` | å­—ç¬¦ä¸²æšä¸¾ | `"true"` | å¯ç”¨å…¬å¼è¯†åˆ«ï¼ˆ`"true"` æˆ– `"false"`ï¼‰ |
| `enableTable` | å­—ç¬¦ä¸²æšä¸¾ | `"true"` | å¯ç”¨è¡¨æ ¼è¯†åˆ«ï¼ˆ`"true"` æˆ– `"false"`ï¼‰ |
| `language` | å­—ç¬¦ä¸²æšä¸¾ | `"ch"` | æ–‡æ¡£è¯­è¨€ï¼ˆ`"en"` æˆ– `"ch"`ï¼‰ |
| `modelVersion` | å­—ç¬¦ä¸²æšä¸¾ | `"pipeline"` | æ¨¡å‹ç‰ˆæœ¬ï¼ˆ`"pipeline"` æˆ– `"vlm"`ï¼‰ |

> **æ³¨æ„**ï¼šåœ¨æˆæƒé¡µé¢è®¾ç½®çš„é…ç½®å€¼ä½œä¸ºé»˜è®¤å€¼ã€‚åœ¨ç¼–ç¨‹è°ƒç”¨å·¥å…·æ—¶å¯ä»¥è¦†ç›–è¿™äº›å€¼ã€‚

## æ¶æ„

### ç»„ä»¶

- **MinerUToolsetStrategy**ï¼šå®ç° `IToolsetStrategy` æ¥å£ï¼Œå°† MinerU æ³¨å†Œä¸ºå†…ç½®å·¥å…·é›†
- **MinerUToolset**ï¼šæ‰©å±• `BuiltinToolset`ï¼Œæä¾› PDF è§£æå™¨å·¥å…·
- **MinerUClient**ï¼šå¤„ç†ä¸ MinerU API çš„é€šä¿¡ï¼ˆæ”¯æŒå®˜æ–¹å’Œè‡ªæ‰˜ç®¡ï¼‰
- **MinerUResultParserService**ï¼šè§£æ MinerU å“åº”å¹¶æå– Markdown å†…å®¹
- **MinerUTransformerStrategy**ï¼šå®ç°çŸ¥è¯†åº“ç®¡é“çš„æ–‡æ¡£è½¬æ¢

### æœåŠ¡å™¨ç±»å‹

æ’ä»¶æ”¯æŒä¸¤ç§ MinerU éƒ¨ç½²ç±»å‹ï¼š

1. **å®˜æ–¹æœåŠ¡å™¨** (`https://mineru.net/api/v4`)
   - éœ€è¦ API Key è®¤è¯
   - ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡å·¥ä½œæµ
   - è½®è¯¢ä»»åŠ¡å®ŒæˆçŠ¶æ€

2. **è‡ªæ‰˜ç®¡æœåŠ¡å™¨**
   - å¯ä»¥åœ¨æ²¡æœ‰è®¤è¯çš„æƒ…å†µä¸‹å·¥ä½œï¼ˆå–å†³äºæ‚¨çš„è®¾ç½®ï¼‰
   - æ”¯æŒç›´æ¥æ–‡ä»¶ä¸Šä¼ å’Œå³æ—¶è§£æ
   - åœ¨æœ¬åœ°ç¼“å­˜ç»“æœ

æ’ä»¶ä¼šæ ¹æ® API URL è‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨ç±»å‹ã€‚

## æƒé™

æ’ä»¶éœ€è¦ä»¥ä¸‹æƒé™ï¼š

- **æ–‡ä»¶ç³»ç»Ÿ**ï¼š`read`ã€`write`ã€`list` æ“ä½œï¼Œç”¨äºå­˜å‚¨æå–çš„å›¾åƒå’Œèµ„æº
- **é›†æˆ**ï¼ˆç”¨äºè½¬æ¢å™¨ï¼‰ï¼šè®¿é—® MinerU é›†æˆé…ç½®

ç¡®ä¿åœ¨æ‚¨çš„ XpertAI æˆæƒç­–ç•¥ä¸­æˆäºˆè¿™äº›æƒé™ã€‚

## è¾“å‡ºæ ¼å¼

æ’ä»¶è¿”å›ç»“æ„åŒ–æ–‡æ¡£ï¼ŒåŒ…å«ï¼š

- **Markdown å†…å®¹**ï¼šå®Œæ•´æ–‡æ¡£æ–‡æœ¬ï¼Œé‡‡ç”¨ Markdown æ ¼å¼ï¼Œæ ¼å¼æ­£ç¡®
- **å…ƒæ•°æ®**ï¼šåŒ…æ‹¬ MinerU ä»»åŠ¡ IDã€åç«¯ç‰ˆæœ¬ã€æ–‡æ¡£è¯­è¨€ç­‰
- **èµ„æº**ï¼šæå–çš„å›¾åƒå’Œæ–‡ä»¶åˆ—è¡¨åŠå…¶å­˜å‚¨ä½ç½®
- **ç»“æ„åŒ–æ•°æ®**ï¼šç”¨äºé«˜çº§å¤„ç†çš„å¸ƒå±€ JSON å’Œå†…å®¹åˆ—è¡¨

## å¼€å‘

### æ„å»º

```bash
# æ„å»ºæ’ä»¶
npx nx build @xpert-ai/plugin-mineru

# è·³è¿‡ç¼“å­˜æ„å»º
npx nx build @xpert-ai/plugin-mineru --skip-nx-cache
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npx nx test @xpert-ai/plugin-mineru

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx nx test @xpert-ai/plugin-mineru --testFile=mineru.client.spec.ts
```

### é¡¹ç›®ç»“æ„

```
packages/mineru/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ mineru-toolset.strategy.ts    # å·¥å…·é›†ç­–ç•¥å®ç°
â”‚   â”‚   â”œâ”€â”€ mineru.toolset.ts             # å·¥å…·é›†ç±»
â”‚   â”‚   â”œâ”€â”€ mineru.tool.ts                # å·¥å…·æ„å»ºå™¨
â”‚   â”‚   â”œâ”€â”€ mineru.client.ts              # MinerU API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ result-parser.service.ts      # ç»“æœè§£ææœåŠ¡
â”‚   â”‚   â”œâ”€â”€ transformer-mineru.strategy.ts # æ–‡æ¡£è½¬æ¢å™¨
â”‚   â”‚   â””â”€â”€ types.ts                      # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ index.ts                          # æ’ä»¶å…¥å£ç‚¹
â”‚   â””â”€â”€ mineru.plugin.ts                  # NestJS æ¨¡å—
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **"MinerU apiKey is required"**
   - ç¡®ä¿æ‚¨å·²åœ¨æˆæƒé¡µé¢é…ç½®äº† API Key
   - æ£€æŸ¥å‡­è¯æ˜¯å¦æ­£ç¡®ä¿å­˜

2. **"MinerU official API requires an access token"**
   - å®˜æ–¹ MinerU æœåŠ¡å™¨éœ€è¦æœ‰æ•ˆçš„ API Key
   - éªŒè¯æ‚¨çš„ API Key æ˜¯å¦æ­£ç¡®ä¸”æœªè¿‡æœŸ

3. **è¿æ¥è¢«æ‹’ç»ï¼ˆè‡ªæ‰˜ç®¡ï¼‰**
   - éªŒè¯æ‚¨çš„è‡ªæ‰˜ç®¡ MinerU æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥ API URL æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸

4. **ä»»åŠ¡è¶…æ—¶**
   - å¤§å‹ PDF å¯èƒ½éœ€è¦æ›´é•¿çš„å¤„ç†æ—¶é—´
   - æ£€æŸ¥ MinerU æœåŠ¡å™¨æ—¥å¿—ä»¥äº†è§£å¤„ç†çŠ¶æ€
   - è€ƒè™‘ä½¿ç”¨ VLM æ¨¡å‹ä»¥è·å¾—æ›´å¿«çš„å¤„ç†é€Ÿåº¦

## API å‚è€ƒ

### MinerUToolsetConfig

```typescript
interface MinerUToolsetConfig {
  apiUrl?: string;
  apiKey?: string;
  isOcr?: boolean | string;
  enableFormula?: boolean | string;
  enableTable?: boolean | string;
  language?: 'en' | 'ch';
  modelVersion?: 'pipeline' | 'vlm';
}
```

### å·¥å…·è¾“å…¥æ¨¡å¼

```typescript
{
  doc_url: string;  // å¿…å¡«ï¼šè¦è½¬æ¢çš„ PDF æ–‡æ¡£ URL
}
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [AGPL-3.0 è®¸å¯è¯](../../../LICENSE)ã€‚

## æ”¯æŒ

- **æ–‡æ¡£**ï¼š[MinerU API æ–‡æ¡£](https://mineru.net/apiManage/docs)
- **é—®é¢˜åé¦ˆ**ï¼š[GitHub Issues](https://github.com/xpert-ai/xpert-plugins/issues)
- **å®˜ç½‘**ï¼š[MinerU ç½‘ç«™](https://mineru.net)

## æ›´æ–°æ—¥å¿—

æŸ¥çœ‹ [CHANGELOG.md](./CHANGELOG.md) äº†è§£ç‰ˆæœ¬å†å²å’Œæ›´æ–°ã€‚

